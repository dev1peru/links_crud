<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Links CRUD</title>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>

<style>
:root{
  --bg:#f6f7fb;
  --card:#ffffff;
  --text:#121826;
  --muted:#667085;
  --line:#e6e8ef;
  --btn:#111827;
  --btnText:#fff;
  --danger:#e11d48;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* LINKS CLEAN */
a{
  color:inherit;
  text-decoration:none;
}
a:hover{
  text-decoration:underline;
}

/* HEADER FULL WIDTH */
header{
  padding:18px 22px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  width:100%;
}

h1{
  margin:0;
  font-size:22px;
}

.topbar{
  display:flex;
  gap:10px;
}

.btn{
  border:0;
  background:var(--btn);
  color:var(--btnText);
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
  font-weight:600;
  font-size:13px;
}

.btn.secondary{
  background:#fff;
  color:#111827;
  border:1px solid var(--line);
}

.wrap{
  padding:0 22px 28px;
  width:100%;
}

/* 3 columns */
.sections-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:14px;
  margin-top:10px;
}

.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:14px;
  padding:12px;
  box-shadow:0 2px 10px rgba(16,24,40,.04);
}

/* COLORED HEADER */
.card-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 12px;
  margin:-12px -12px 10px;
  border-radius:14px 14px 10px 10px;
  background:var(--secBg,#fff);
  color:var(--secText,var(--text));
}

.card-title{
  font-weight:800;
  display:flex;
  gap:8px;
  align-items:center;
}

.links{
  display:flex;
  flex-direction:column;
  gap:8px;
  margin-top:10px;
}

.link-row{
  padding:8px 10px;
  background:#fafbff;
  border:1px solid #eef1f7;
  border-radius:10px;
}

.link-url{display:none;}

.icon-btn{
  border:1px solid var(--line);
  background:#fff;
  padding:6px 8px;
  border-radius:10px;
  cursor:pointer;
  font-size:12px;
}

.icon-btn.danger{
  background:#fff5f7;
  color:#b42318;
}

.color-select{
  border:1px solid rgba(0,0,0,.12);
  border-radius:8px;
  padding:4px 6px;
  font-size:12px;
  background:white;
}

.edit-only{display:none;}
body.editing .edit-only{display:inline-flex;}

</style>
</head>

<body>

<header>
  <h1>My Links</h1>
  <div class="topbar">
    <button id="editBtn" class="btn secondary">Edit</button>
    <button id="saveBtn" class="btn" style="display:none;">Save</button>
  </div>
</header>

<div class="wrap">

  <div id="addSectionTop" class="edit-only" style="margin-bottom:14px;">
    <input id="newSectionName" placeholder="New section name" />
    <button class="btn" id="addSectionBtn">Add Section</button>
  </div>

  <div id="sectionsGrid" class="sections-grid"></div>

</div>

<script>
const API = "";

const COLOR_THEME = {
  slate:{bg:"#eef2f7",text:"#111827"},
  blue:{bg:"#e6f0ff",text:"#0b1f44"},
  green:{bg:"#e8f7ee",text:"#0b2a16"},
  amber:{bg:"#fff3d6",text:"#3a2a05"},
  red:{bg:"#ffe7ea",text:"#3b0a12"},
  purple:{bg:"#f1e8ff",text:"#24113a"},
  pink:{bg:"#ffe8f2",text:"#3a0b22"},
  teal:{bg:"#e6fbf8",text:"#062c2a"},
};

let state={
  editMode:false,
  sections:[],
  pendingColors:new Map()
};

const grid=document.getElementById("sectionsGrid");
const editBtn=document.getElementById("editBtn");
const saveBtn=document.getElementById("saveBtn");

editBtn.onclick=()=>{
  state.pendingColors.clear();
  state.editMode=true;
  document.body.classList.add("editing");
  editBtn.style.display="none";
  saveBtn.style.display="inline-flex";
  render();
};

saveBtn.onclick=async()=>{
  for(const [id,color] of state.pendingColors){
    await fetch(`/sections/${id}`,{
      method:"PUT",
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({color})
    });
  }
  state.pendingColors.clear();
  state.editMode=false;
  document.body.classList.remove("editing");
  editBtn.style.display="inline-flex";
  saveBtn.style.display="none";
  await load();
};

async function load(){
  const r=await fetch("/sections");
  state.sections=await r.json();
  render();
}

function render(){
  grid.innerHTML="";
  for(const sec of state.sections){
    const color=state.pendingColors.get(sec.id)||sec.color||"slate";
    const theme=COLOR_THEME[color];

    const card=document.createElement("div");
    card.className="card";
    card.style.setProperty("--secBg",theme.bg);
    card.style.setProperty("--secText",theme.text);

    card.innerHTML=`
      <div class="card-header">
        <div class="card-title">${sec.name}</div>
        <div>
          <select class="color-select edit-only" data-id="${sec.id}">
            ${Object.keys(COLOR_THEME).map(c=>
              `<option value="${c}" ${c===color?'selected':''}>${c}</option>`
            ).join("")}
          </select>
        </div>
      </div>
      <div class="links">
        ${sec.links.map(l=>`
          <div class="link-row">
            <a href="${l.url}" target="_blank">${l.title}</a>
          </div>
        `).join("")}
      </div>
    `;

    grid.appendChild(card);
  }

  document.querySelectorAll(".color-select").forEach(sel=>{
    sel.onchange=e=>{
      state.pendingColors.set(Number(e.target.dataset.id),e.target.value);
      render();
    };
  });
}

load();
</script>

</body>
</html>
